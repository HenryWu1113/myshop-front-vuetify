import{aB as B,r as k,N as f,a as d,c,b as i,d as l,w as o,H as g,V as C,a6 as z,Q as D,R as I,F as S,ac as h,T as V,f as r,O as N,a2 as q,t as _,a7 as A,a8 as E,a9 as P,aa as $,ax as L,ab as R,ay as G,aI as U,aD as H,az as M,U as O,aF as Q,aG as W,W as v,X}from"./index.b772be69.js";import{V as j}from"./VTable.850523af.js";import{V as J}from"./VCheckbox.78dddbef.js";import{V as K}from"./VFileInput.3da328bb.js";import{V as Y}from"./VTextarea.1a4dc330.js";const x=m=>(Q("data-v-7907cfac"),m=m(),W(),m),Z={class:"container pt-10"},ee=x(()=>i("h1",{class:"text-h2 text-brown text-center mt-15 font-weight-bold"},"\u5546\u54C1\u7BA1\u7406",-1)),te=v("\u65B0\u589E\u5546\u54C1"),le=x(()=>i("thead",null,[i("tr",null,[i("th",{class:"text-h6 font-weight-bold"},"\u5716\u7247"),i("th",{class:"text-h6 font-weight-bold"},"\u540D\u7A31"),i("th",{class:"text-h6 font-weight-bold"},"\u5206\u985E"),i("th",{class:"text-h6 font-weight-bold"},"\u4E0A\u67B6"),i("th",{class:"text-h6 font-weight-bold"},"\u7BA1\u7406")])],-1)),ae={key:1},se={key:0,class:"text-center",colspan:"5"},oe=x(()=>i("h1",null," \u6C92\u6709\u5546\u54C1 ",-1)),ie=[oe],ne={class:"text-center mt-5"},re=v("\u53D6\u6D88"),de=v("\u78BA\u5B9A"),ue={__name:"ProductsView",setup(m){const b=k(!1),y=k(!1),n=f([]),F=f(["\u8292\u679C","\u9999\u8549","\u706B\u9F8D\u679C"]),e=f({_id:"",name:"",price:"",category:"",description:"",image:[],sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),u=f({required(s){return!!s||"\u5FC5\u586B"},price(s){return s>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(s){var t,a,p;return!s||!s.length||((a=(t=s[0])==null?void 0:t.type)==null?void 0:a.includes("image"))&&((p=s[0])==null?void 0:p.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),w=(s,t)=>{console.log(e.image),e._id=s,t>-1?(e.name=n[t].name,e.price=n[t].price,e.category=n[t].category,e.sell=n[t].sell,e.description=n[t].description):(e.name="",e.price=0,e.category="",e.sell=!1,e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},T=async()=>{if(!e.valid)return;e.submitting=!0;const s=new FormData;for(const t in e)["_id","idx","valid","submitting","dialog"].includes(t)||(t==="image"?s.append(t,e[t][0]):s.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await h.post("/products",s);n.push(t.result),V.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await h.patch("/products/"+e._id,s);n[e.idx]=t.result,console.log(e),console.log(e.idx),V.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){V.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};return(async()=>{try{b.value=!0;const{data:s}=await h.get("/products/all");n.push(...s.result),y.value=!0,b.value=!1}catch(s){V.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})(),(s,t)=>(d(),c(S,null,[i("div",Z,[ee,l(g,{class:"mt-5",variant:"outlined",color:"orange",onClick:t[0]||(t[0]=a=>w("",-1))},{default:o(()=>[te]),_:1}),l(C,{class:"mt-10"},{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[l(j,{class:"text-brown"},{default:o(()=>[le,i("tbody",null,[n.length>0?(d(!0),c(S,{key:0},N(n,(a,p)=>(d(),c("tr",{key:a._id},[i("td",null,[l(q,{src:a.image,cover:"",height:"200"},null,8,["src"])]),i("td",null,_(a.name),1),i("td",null,_(a.category),1),i("td",null,_(a.sell===!0?"\u4E0A\u67B6\u4E2D":"\u5DF2\u4E0B\u67B6"),1),i("td",null,[l(g,{icon:"",variant:"text",onClick:me=>w(a._id,p)},{default:o(()=>[l(A,{icon:"mdi-pen"})]),_:2},1032,["onClick"])])]))),128)):(d(),c("tr",ae,[y.value?(d(),c("td",se,ie)):I("",!0)]))])]),_:1})]),_:1})]),_:1})]),l(z,{modelValue:e.dialog,"onUpdate:modelValue":t[9]||(t[9]=a=>e.dialog=a),persistent:""},{default:o(()=>[l(E,{onSubmit:P(T,["prevent"]),modelValue:e.valid,"onUpdate:modelValue":t[8]||(t[8]=a=>e.valid=a)},{default:o(()=>[l($,null,{default:o(()=>[l(L,null,{default:o(()=>[i("h2",ne,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l(R,null,{default:o(()=>[l(G,null,{default:o(()=>[l(C,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[l(U,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.name=a),label:"\u5546\u54C1\u540D\u7A31",rules:[u.required],variant:"outlined","append-inner-icon":"mdi-star-outline"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(U,{type:"number",min:"0",modelValue:e.price,"onUpdate:modelValue":t[2]||(t[2]=a=>e.price=a),label:"\u5546\u54C1\u50F9\u683C",rules:[u.required,u.price],variant:"outlined","append-inner-icon":"mdi-bitcoin"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(H,{items:F,type:"number",min:"0",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=a=>e.category=a),label:"\u5546\u54C1\u5206\u985E",rules:[u.required],variant:"outlined","append-inner-icon":"mdi-lipstick"},null,8,["items","modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(J,{modelValue:e.sell,"onUpdate:modelValue":t[4]||(t[4]=a=>e.sell=a),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(K,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=a=>e.image=a),"show-size":"",accept:"image/*",label:"\u5546\u54C1\u5716\u7247",rules:[u.size],variant:"outlined","prepend-icon":"","append-inner-icon":"mdi-link-variant"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(Y,{modelValue:e.description,"onUpdate:modelValue":t[6]||(t[6]=a=>e.description=a),label:"\u5546\u54C1\u63CF\u8FF0",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(M,null,{default:o(()=>[l(O),l(g,{color:"brown",onClick:t[7]||(t[7]=a=>e.dialog=!1),disabled:e.submitting,variant:"outlined"},{default:o(()=>[re]),_:1},8,["disabled"]),l(g,{type:"submit",color:"orange",loading:e.submitting,variant:"outlined"},{default:o(()=>[de]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1},8,["modelValue"]),b.value?(d(),D(X,{key:0})):I("",!0)],64))}};var be=B(ue,[["__scopeId","data-v-7907cfac"]]);export{be as default};
