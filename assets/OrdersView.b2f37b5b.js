import{ap as K,J as W,r as C,K as x,z as G,o as _,c as p,b as e,w as s,au as H,a5 as F,S,V as h,e as o,aC as T,d as y,a as n,F as U,M as B,O as I,N as v,L as u,D as g,a0 as N,$ as D,a3 as P,at as M,a4 as O,av as z,a1 as Q,a2 as X,aF as $,R as q,ay as Y,az as Z}from"./index.4b7b983c.js";import{v as ee}from"./index.882724bf.js";const r=V=>(Y("data-v-fd9b0df0"),V=V(),Z(),V),te={id:"back_order_view"},se=r(()=>n("h1",{class:"text-h2 text-center mt-15"},[n("b",null,"\u8A02\u55AE\u7BA1\u7406")],-1)),le=r(()=>n("span",null,"\u8A02\u55AE\u7DE8\u865F",-1)),ae=r(()=>n("span",null,"\u8A02\u8CFC\u65E5\u671F",-1)),ne=r(()=>n("span",null,"\u8A02\u55AE\u72C0\u614B",-1)),oe=r(()=>n("span",null,"\u7E3D\u50F9",-1)),de=r(()=>n("span",null,"\u8A73\u7D30\u8CC7\u8A0A",-1)),ie=r(()=>n("span",null,"\u8A02\u55AE\u8CC7\u8A0A",-1)),re={class:"order_panel"},ce=["onClick"],ue=["onClick"],_e=r(()=>n("span",{class:"d-lg-none"},"\u8A02\u8CFC\u65E5\u671F : ",-1)),pe=r(()=>n("span",{class:"d-lg-none"},"\u8A02\u55AE\u72C0\u614B : ",-1)),me={key:0},fe={key:1},xe={key:2},he=r(()=>n("span",{class:"d-lg-none"},"\u7E3D\u50F9 : ",-1)),ve=r(()=>n("span",{class:"d-lg-none"},"\u8A73\u7D30\u8CC7\u8A0A : ",-1)),ge=r(()=>n("span",{class:"d-lg-none"},"\u8A02\u55AE\u8CC7\u8A0A : ",-1)),Ve={key:1,class:"text-h1 text-center mt-10"},be={class:"text-center mt-4 text-brown"},ke=r(()=>n("span",{class:"text-brown"},"\u7522\u54C1",-1)),we=r(()=>n("span",{class:"text-brown"},"\u55AE\u50F9",-1)),ye=r(()=>n("span",{class:"text-brown"},"\u6578\u91CF",-1)),Ce=r(()=>n("span",{class:"text-brown"},"\u7E3D\u50F9",-1)),Se=["onClick"],$e=["onClick"],qe=r(()=>n("span",{class:"d-md-none text-brown"},"\u55AE\u50F9 : ",-1)),Fe={class:"text-deep-orange"},Te=r(()=>n("span",{class:"d-md-none text-brown"},"\u6578\u91CF : ",-1)),Ue={class:"text-brown"},Be=r(()=>n("span",{class:"d-md-none text-brown"},"\u7E3D\u50F9 : ",-1)),Ie={class:"text-deep-orange"},Ne=q("\u95DC\u9589"),De={class:"text-center mt-4 text-brown"},Pe={class:"text-center text-brown mb-4"},Me=q("\u95DC\u9589"),Oe=q(" \u78BA\u8A8D\u66F4\u6539 "),ze={__name:"OrdersView",setup(V){const b=W(),k=C(!1),m=C(!1),f=C("\u5168\u90E8"),d=x([]),a=x({_id:"",nickname:"",cellphone:"",address:"",receiver:"",state:0,idx:0,valid:!1,submitting:!1}),w=x({required(i){return!!i||"\u5FC5\u586B"},isMobilePhone(i){return ee.exports.isMobilePhone(i,"zh-TW")||"\u624B\u6A5F\u865F\u78BC\u683C\u5F0F\u932F\u8AA4"}}),A=x(["\u5168\u90E8","\u672A\u4ED8\u6B3E","\u8A02\u55AE\u6210\u7ACB","\u8A02\u55AE\u53D6\u6D88"]),E=x([{opt:"\u672A\u4ED8\u6B3E",value:0},{opt:"\u8A02\u55AE\u6210\u7ACB",value:1},{opt:"\u8A02\u55AE\u53D6\u6D88",value:2}]),L=G(()=>f.value==="\u5168\u90E8"?d:f.value==="\u672A\u4ED8\u6B3E"?d.filter(i=>i.state===0):f.value==="\u8A02\u55AE\u6210\u7ACB"?d.filter(i=>i.state===1):d.filter(i=>i.state===2)),R=i=>{const l=d.findIndex(t=>t._id===i);a._id=d[l]._id,a.idx=l,k.value=!0},j=i=>{const l=d.findIndex(t=>t._id===i);a._id=d[l]._id,a.nickname=d[l].user.nickname,a.cellphone=d[l].cellphone,a.receiver=d[l].receiver,a.address=d[l].address,a.state=d[l].state,a.idx=l,m.value=!0},J=async()=>{if(!a.valid)return;a.submitting=!0;const i={receiver:a.receiver,cellphone:a.cellphone,address:a.address,state:a.state};try{const{data:l}=await F.patch("/orders/"+a._id,i);d[a.idx]=l.result,d[a.idx].totalPrice=d[a.idx].products.reduce((t,c)=>t+c.product.price*c.quantity,0),console.log(d),S.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}catch(l){console.log(l),S.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}m.value=!1,a.submitting=!1};return(async()=>{try{const{data:i}=await F.get("/orders/all");console.log(i.result),d.push(...i.result.map(l=>(l.totalPrice=l.products.reduce((t,c)=>t+c.product.price*c.quantity,0),l)))}catch{S.fire({icon:"error",title:"\u5931\u6557",text:"\u7121\u6CD5\u53D6\u5F97\u8A02\u55AE"})}})(),(i,l)=>(_(),p("div",te,[e(H,null,{default:s(()=>[se,e(h,{class:"mt-5"},{default:s(()=>[e(o,{cols:"12",md:"3",sm:"4"},{default:s(()=>[e(T,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),variant:"outlined",items:A,"append-inner-icon":"mdi-pistol"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(h,{class:"d-none d-lg-flex"},{default:s(()=>[e(o,{class:"text-h6"},{default:s(()=>[le]),_:1}),e(o,{class:"text-h6"},{default:s(()=>[ae]),_:1}),e(o,{class:"text-h6"},{default:s(()=>[ne]),_:1}),e(o,{class:"text-h6"},{default:s(()=>[oe]),_:1}),e(o,{class:"text-h6"},{default:s(()=>[de]),_:1}),e(o,{class:"text-h6"},{default:s(()=>[ie]),_:1})]),_:1}),e(y,{class:"mb-10 d-none d-lg-block"}),n("div",re,[d.length>0?(_(!0),p(U,{key:0},B(v(L),t=>(_(),I(h,{key:t._id,class:"pt-3 pb-3 mt-10",style:{"border-left":"3px solid #FFEB3B"}},{default:s(()=>[e(o,{cols:"12",lg:"",class:"d-flex align-center"},{default:s(()=>[n("span",{class:"d-lg-none",onClick:c=>v(b).push("/order/"+t._id),style:{cursor:"pointer"}},"\u8A02\u55AE\u7DE8\u865F : ",8,ce),n("span",{onClick:c=>v(b).push("/order/"+t._id),style:{cursor:"pointer"}},u(t._id),9,ue)]),_:2},1024),e(o,{cols:"12",lg:"",class:"d-flex align-center"},{default:s(()=>[_e,n("span",null,u(new Date(t.date).toLocaleString()),1)]),_:2},1024),e(o,{cols:"12",sm:"3",lg:"",class:"d-flex align-center"},{default:s(()=>[pe,t.state===0?(_(),p("span",me,"\u672A\u4ED8\u6B3E")):t.state===1?(_(),p("span",fe,"\u8A02\u55AE\u6210\u7ACB")):(_(),p("span",xe,"\u8A02\u55AE\u53D6\u6D88"))]),_:2},1024),e(o,{cols:"12",sm:"3",lg:"",class:"d-flex align-center"},{default:s(()=>[he,n("span",null,"NT. "+u(t.totalPrice),1)]),_:2},1024),e(o,{cols:"12",sm:"3",lg:""},{default:s(()=>[ve,e(g,{icon:"",variant:"text",onClick:c=>R(t._id)},{default:s(()=>[e(N,{icon:"mdi-plus"})]),_:2},1032,["onClick"])]),_:2},1024),e(o,{cols:"12",sm:"3",lg:""},{default:s(()=>[ge,e(g,{icon:"",variant:"text",onClick:c=>j(t._id)},{default:s(()=>[e(N,{icon:"mdi-pen"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)):(_(),p("h1",Ve,"\u6C92\u6709\u8A02\u55AE\u54E6")),e(D,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=t=>k.value=t)},{default:s(()=>[e(P,null,{default:s(()=>[e(M,null,{default:s(()=>[n("h3",be,"~~~~~ \u8A02\u55AE\u7DE8\u865F :"+u(a._id)+" ~~~~~",1)]),_:1}),e(O,null,{default:s(()=>[e(h,{class:"d-none d-md-flex"},{default:s(()=>[e(o,{cols:"12",md:"5"},{default:s(()=>[ke]),_:1}),e(o,{cols:"12",md:"2"},{default:s(()=>[we]),_:1}),e(o,{cols:"12",md:"2"},{default:s(()=>[ye]),_:1}),e(o,{cols:"12",md:"3"},{default:s(()=>[Ce]),_:1})]),_:1}),e(y,{class:"d-none d-md-block mb-1"}),(_(!0),p(U,null,B(d[a.idx].products,t=>(_(),I(h,{key:t._id},{default:s(()=>[e(o,{cols:"12",md:"5"},{default:s(()=>[n("span",{class:"d-none d-md-block text-brown",onClick:c=>v(b).push("/product/"+t.product._id),style:{cursor:"pointer"}},u(t.product.name),9,Se),n("span",{class:"d-md-none text-h6 text-brown",onClick:c=>v(b).push("/product/"+t.product._id),style:{cursor:"pointer"}},[n("b",null,u(t.product.name),1)],8,$e)]),_:2},1024),e(o,{cols:"4",md:"2"},{default:s(()=>[qe,n("span",Fe,"NT. "+u(t.product.price),1)]),_:2},1024),e(o,{cols:"4",md:"2"},{default:s(()=>[Te,n("span",Ue,u(t.quantity),1)]),_:2},1024),e(o,{cols:"4",md:"3"},{default:s(()=>[Be,n("span",Ie,"NT. "+u(t.product.price*t.quantity),1)]),_:2},1024),e(y,{class:"d-md-none"})]),_:2},1024))),128)),e(y,{class:"d-none d-md-block"})]),_:1}),e(z,null,{default:s(()=>[e(g,{color:"brown",block:"",onClick:l[1]||(l[1]=t=>k.value=!1)},{default:s(()=>[Ne]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:m.value,"onUpdate:modelValue":l[9]||(l[9]=t=>m.value=t),persistent:""},{default:s(()=>[e(Q,{onSubmit:X(J,["prevent"]),modelValue:a.valid,"onUpdate:modelValue":l[8]||(l[8]=t=>a.valid=t)},{default:s(()=>[e(P,null,{default:s(()=>[e(M,null,{default:s(()=>[n("h3",De,"~~~~~ \u8A02\u55AE\u7DE8\u865F :"+u(a._id)+" ~~~~~",1)]),_:1}),e(O,null,{default:s(()=>[n("h2",Pe,"\u6703\u54E1 : "+u(a.nickname),1),e($,{modelValue:a.receiver,"onUpdate:modelValue":l[3]||(l[3]=t=>a.receiver=t),type:"text",label:"\u6536\u4EF6\u8005\u59D3\u540D",placeholder:"\u8ACB\u8F38\u5165\u6536\u4EF6\u8005\u59D3\u540D",counter:"10",maxlength:"10",rules:[w.required],variant:"outlined"},null,8,["modelValue","rules"]),e($,{modelValue:a.cellphone,"onUpdate:modelValue":l[4]||(l[4]=t=>a.cellphone=t),type:"text",label:"\u6536\u4EF6\u8005\u96FB\u8A71",placeholder:"\u8ACB\u8F38\u5165\u6536\u4EF6\u8005\u96FB\u8A71",rules:[w.required,w.isMobilePhone],variant:"outlined"},null,8,["modelValue","rules"]),e($,{modelValue:a.address,"onUpdate:modelValue":l[5]||(l[5]=t=>a.address=t),type:"text",label:"\u6536\u4EF6\u5730\u5740",placeholder:"\u8ACB\u8F38\u5165\u6536\u4EF6\u5730\u5740",rules:[w.required],variant:"outlined"},null,8,["modelValue","rules"]),e(T,{modelValue:a.state,"onUpdate:modelValue":l[6]||(l[6]=t=>a.state=t),items:E,"item-title":"opt","item-value":"value",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(z,{class:"d-flex justify-center mb-3"},{default:s(()=>[e(g,{color:"brown",variant:"outlined",onClick:l[7]||(l[7]=t=>m.value=!1)},{default:s(()=>[Me]),_:1}),e(g,{color:"warning",variant:"outlined",type:"submit",loading:a.submitting},{default:s(()=>[Oe]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1},8,["modelValue"])])]),_:1})]))}};var Re=K(ze,[["__scopeId","data-v-fd9b0df0"]]);export{Re as default};
