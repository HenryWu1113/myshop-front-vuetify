import{o as z,A,a3 as B,a4 as N,r as v,N as V,a as C,c as D,b as u,t as i,d as a,w as n,V as U,a5 as M,Q as R,R as E,F as H,ab as I,T as j,f as r,e as m,H as _,W as g,a7 as L,a8 as O,a9 as Q,aw as W,aa as X,ax as Z,aH as k,ay as q,U as G,X as J}from"./index.b79e5a8d.js";import{v as K}from"./index.85d3e503.js";import{V as P}from"./VFileInput.4436c003.js";import"./assertString.31c1207f.js";import"./isEmail.07d4cae7.js";import"./isMobilePhone.1f4ee56f.js";const Y={id:"userinfo_view"},ee={class:"MyContainer"},ae={class:"text-h2 text-center text-brown font-weight-bold mt-10 mb-10","data-aos":"fade-down","data-aos-duration":"1000","data-aos-offset":"150"},te={class:"user_info_card"},le=["src"],ne={class:"user_info"},oe={class:"user_info"},se={class:"user_info"},ie={class:"text-center mt-3 mb-3"},Ve={__name:"UserinfoView",setup(ue){z(()=>{A.init()});const w=B(),{editUser:$}=w,{nickname:b,email:h,account:y,avatar:F}=N(w),f=v(!1),c=v(!1),p=v(!1),s=V({account:"",email:"",nickname:"",avatar:[]}),o=V({account:"",email:"",nickname:"",avatar:[]}),d=V({account:[e=>!!e||"\u5E33\u865F\u5FC5\u586B",e=>e.length>=4&&e.length<=20||"\u5E33\u865F\u9577\u5EA6\u70BA 4 \u5230 20 \u500B\u5B57",e=>/^[a-zA-Z0-9]+$/.test(e)||"\u5E33\u865F\u53EA\u80FD\u7531\u82F1\u6578\u5B57\u7D44\u6210"],nickname:[e=>!!e||"\u66B1\u7A31\u5FC5\u586B",e=>e&&e.length<=10||"\u66B1\u7A31\u9577\u5EA6\u4E0D\u5F97\u8D85\u904E 10 \u500B\u5B57"],email:[e=>!!e||"\u96FB\u5B50\u4FE1\u7BB1\u5FC5\u586B",e=>K.exports.isEmail(e)||"\u96FB\u5B50\u4FE1\u7BB1\u683C\u5F0F\u932F\u8AA4"],size:[e=>{var l,t,x;return!e||!e.length||((t=(l=e[0])==null?void 0:l.type)==null?void 0:t.includes("image"))&&((x=e[0])==null?void 0:x.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}]}),S=()=>{c.value=!0,o.account=y.value,o.email=h.value,o.nickname=b.value,o.avatar=[]},T=async()=>{if(!p.value)return;const e=new FormData;for(const t in o)["account"].includes(t)||(t==="avatar"?e.append("image",o[t][0]):e.append(t,o[t]));const l=await $(e);console.log(e),l&&(s.account=y.value,s.email=h.value,s.nickname=b.value,s.avatar=F.value),c.value=!1};return(async()=>{try{f.value=!0;const{data:e}=await I.get("/users");o.account=e.result.account,o.email=e.result.email,o.nickname=e.result.nickname,s.account=e.result.account,s.email=e.result.email,s.nickname=e.result.nickname,s.avatar=e.result.avatar,f.value=!1}catch(e){console.log(e),j.fire({icon:"error",title:"\u5931\u6557",text:"\u7121\u6CD5\u53D6\u5F97\u500B\u4EBA\u8CC7\u6599"})}})(),(e,l)=>(C(),D(H,null,[u("div",Y,[u("div",ee,[u("h1",ae,i(e.$t("selfinfo")),1),u("div",te,[a(U,null,{default:n(()=>[a(r,{cols:"12",md:"4",class:"text-cneter"},{default:n(()=>[u("img",{src:s.avatar,class:"info_pic"},null,8,le)]),_:1}),a(r,{cols:"12",md:"8",class:"d-flex flex-column justify-center"},{default:n(()=>[u("span",ne,"\u2727"+i(e.$t("account"))+" : "+i(s.account),1),a(m),u("span",oe,"\u2727"+i(e.$t("nickname"))+" : "+i(s.nickname),1),a(m),u("span",se,"\u2727"+i(e.$t("mail"))+" : "+i(s.email),1),a(m)]),_:1}),a(r,{cols:"12",class:"text-center"},{default:n(()=>[a(_,{variant:"outlined",color:"orange",onClick:S,class:"mb-5"},{default:n(()=>[g(i(e.$t("editselfinfo")),1)]),_:1})]),_:1})]),_:1}),a(M,{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=t=>c.value=t),persistent:""},{default:n(()=>[a(L,{onSubmit:O(T,["prevent"]),modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=t=>p.value=t)},{default:n(()=>[a(Q,null,{default:n(()=>[a(W,null,{default:n(()=>[u("h1",ie,i(e.$t("selfinfo")),1)]),_:1}),a(m),a(X,null,{default:n(()=>[a(Z,null,{default:n(()=>[a(U,null,{default:n(()=>[a(r,{cols:"12"},{default:n(()=>[a(k,{type:"account",label:"\u5E33\u865F",placeholder:"\u8ACB\u8F38\u5165\u5E33\u865F",counter:"20",maxlength:"20",modelValue:o.account,"onUpdate:modelValue":l[0]||(l[0]=t=>o.account=t),rules:d.account,"append-inner-icon":"mdi-account-outline",variant:"outlined",disabled:""},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:n(()=>[a(k,{label:"\u66B1\u7A31",placeholder:"\u8ACB\u8F38\u5165\u66B1\u7A31",counter:"10",maxlength:"10",modelValue:o.nickname,"onUpdate:modelValue":l[1]||(l[1]=t=>o.nickname=t),rules:d.nickname,"append-inner-icon":"mdi-emoticon-happy-outline",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:n(()=>[a(k,{type:"email",label:"\u96FB\u5B50\u4FE1\u7BB1",placeholder:"\u8ACB\u8F38\u5165\u96FB\u5B50\u4FE1\u7BB1",modelValue:o.email,"onUpdate:modelValue":l[2]||(l[2]=t=>o.email=t),rules:d.email,"append-inner-icon":"mdi-email-outline",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:n(()=>[a(P,{modelValue:o.avatar,"onUpdate:modelValue":l[3]||(l[3]=t=>o.avatar=t),"show-size":"",accept:"image/*",label:"\u5927\u982D\u8CBC",rules:d.size,variant:"outlined","prepend-icon":"","append-inner-icon":"mdi-link-variant"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(q,null,{default:n(()=>[a(G),a(_,{color:"brown",onClick:l[4]||(l[4]=t=>c.value=!1)},{default:n(()=>[g(i(e.$t("cancel")),1)]),_:1}),a(_,{type:"submit",color:"warning"},{default:n(()=>[g(i(e.$t("confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1},8,["modelValue"])])])]),f.value?(C(),R(J,{key:0})):E("",!0)],64))}};export{Ve as default};
