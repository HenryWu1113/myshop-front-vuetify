import{ax as F,K as m,o as p,c as f,a as i,b as l,w as o,D as g,V as h,$ as U,F as w,a5 as b,S as V,e as r,M as I,Z as D,L as _,a0 as T,a1 as A,a2 as q,a3 as z,as as B,a4 as P,at as $,aF as k,aA as E,au as N,Q as L,aC as M,aD as R,R as v}from"./index.e98c74e0.js";import{V as K}from"./VTable.258c5c2d.js";import{V as Q}from"./VCheckbox.3c415afd.js";import{V as Z}from"./VFileInput.1b66ba3c.js";import{V as j}from"./VTextarea.5006e62b.js";const x=u=>(M("data-v-d57617f4"),u=u(),R(),u),G={class:"container pt-10"},H=x(()=>i("h1",{class:"text-center"},"Products",-1)),J=v("\u65B0\u589E\u5546\u54C1"),O=x(()=>i("thead",null,[i("tr",null,[i("th",{class:"text-h6"},"\u5716\u7247"),i("th",{class:"text-h6"},"\u540D\u7A31"),i("th",{class:"text-h6"},"\u5206\u985E"),i("th",{class:"text-h6"},"\u4E0A\u67B6"),i("th",{class:"text-h6"},"\u7BA1\u7406")])],-1)),W={key:1},X=x(()=>i("td",{class:"text-center",colspan:"5"},"\u6C92\u6709\u5546\u54C1",-1)),Y=[X],ee={class:"text-center mt-5"},te=v("\u53D6\u6D88"),le=v("\u78BA\u5B9A"),ae={__name:"ProductsView",setup(u){const n=m([]),C=m(["\u8292\u679C","\u9999\u8549","\u706B\u9F8D\u679C"]),e=m({_id:"",name:"",price:"",category:"",description:"",image:[],sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),d=m({required(s){return!!s||"\u5FC5\u586B"},price(s){return s>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(s){var t,a,c;return!s||!s.length||((a=(t=s[0])==null?void 0:t.type)==null?void 0:a.includes("image"))&&((c=s[0])==null?void 0:c.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),y=(s,t)=>{console.log(e.image),e._id=s,t>-1?(e.name=n[t].name,e.price=n[t].price,e.category=n[t].category,e.sell=n[t].sell,e.description=n[t].description):(e.name="",e.price=0,e.category="",e.sell=!1,e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},S=async()=>{if(!e.valid)return;e.submitting=!0;const s=new FormData;for(const t in e)["_id","idx","valid","submitting","dialog"].includes(t)||(t==="image"?s.append(t,e[t][0]):s.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await b.post("/products",s);n.push(t.result),V.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await b.patch("/products/"+e._id,s);n[e.idx]=t.result,console.log(e),console.log(e.idx),V.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){V.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};return(async()=>{try{const{data:s}=await b.get("/products/all");n.push(...s.result),console.log(n)}catch(s){V.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})(),(s,t)=>(p(),f(w,null,[i("div",G,[H,l(g,{class:"mt-5",color:"success",onClick:t[0]||(t[0]=a=>y("",-1))},{default:o(()=>[J]),_:1}),l(h,{class:"mt-10"},{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[l(K,null,{default:o(()=>[O,i("tbody",null,[n.length>0?(p(!0),f(w,{key:0},I(n,(a,c)=>(p(),f("tr",{key:a._id},[i("td",null,[l(D,{src:a.image,cover:"",height:"200"},null,8,["src"])]),i("td",null,_(a.name),1),i("td",null,_(a.category),1),i("td",null,_(a.sell===!0?"\u4E0A\u67B6\u4E2D":"\u5DF2\u4E0B\u67B6"),1),i("td",null,[l(g,{icon:"",variant:"text",onClick:oe=>y(a._id,c)},{default:o(()=>[l(T,{icon:"mdi-pen"})]),_:2},1032,["onClick"])])]))),128)):(p(),f("tr",W,Y))])]),_:1})]),_:1})]),_:1})]),l(U,{modelValue:e.dialog,"onUpdate:modelValue":t[9]||(t[9]=a=>e.dialog=a),persistent:""},{default:o(()=>[l(A,{onSubmit:q(S,["prevent"]),modelValue:e.valid,"onUpdate:modelValue":t[8]||(t[8]=a=>e.valid=a)},{default:o(()=>[l(z,null,{default:o(()=>[l(B,null,{default:o(()=>[i("h2",ee,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l(P,null,{default:o(()=>[l($,null,{default:o(()=>[l(h,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[l(k,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.name=a),label:"\u5546\u54C1\u540D\u7A31",rules:[d.required],variant:"outlined","append-inner-icon":"mdi-star-outline"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(k,{type:"number",min:"0",modelValue:e.price,"onUpdate:modelValue":t[2]||(t[2]=a=>e.price=a),label:"\u5546\u54C1\u50F9\u683C",rules:[d.required,d.price],variant:"outlined","append-inner-icon":"mdi-bitcoin"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(E,{items:C,type:"number",min:"0",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=a=>e.category=a),label:"\u5546\u54C1\u5206\u985E",rules:[d.required],variant:"outlined","append-inner-icon":"mdi-lipstick"},null,8,["items","modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(Q,{modelValue:e.sell,"onUpdate:modelValue":t[4]||(t[4]=a=>e.sell=a),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(Z,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=a=>e.image=a),"show-size":"",accept:"image/*",label:"\u5546\u54C1\u5716\u7247",rules:[d.size],variant:"outlined","prepend-icon":"","append-inner-icon":"mdi-link-variant"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(j,{modelValue:e.description,"onUpdate:modelValue":t[6]||(t[6]=a=>e.description=a),label:"\u5546\u54C1\u63CF\u8FF0",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(N,null,{default:o(()=>[l(L),l(g,{color:"warning",onClick:t[7]||(t[7]=a=>e.dialog=!1),disabled:e.submitting,variant:"outlined"},{default:o(()=>[te]),_:1},8,["disabled"]),l(g,{type:"submit",color:"primary",loading:e.submitting,variant:"outlined"},{default:o(()=>[le]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1},8,["modelValue"])],64))}};var ce=F(ae,[["__scopeId","data-v-d57617f4"]]);export{ce as default};
