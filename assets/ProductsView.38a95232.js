import{ay as U,N as m,a as p,c as f,b as o,d as l,w as i,H as g,V as h,a1 as F,F as w,a7 as b,S as V,f as r,O as I,$ as T,t as _,a2 as B,a3 as D,a4 as q,a5 as z,at as A,a6 as E,au as N,aG as k,aB as P,av as $,T as G,aD as H,aE as L,U as v}from"./index.c80d3659.js";import{V as M}from"./VTable.633abe39.js";import{V as O}from"./VCheckbox.c42b53f4.js";import{V as R}from"./VFileInput.8018cee6.js";import{V as j}from"./VTextarea.01fccb44.js";const y=u=>(H("data-v-d57617f4"),u=u(),L(),u),J={class:"container pt-10"},K=y(()=>o("h1",{class:"text-center"},"Products",-1)),Q=v("\u65B0\u589E\u5546\u54C1"),W=y(()=>o("thead",null,[o("tr",null,[o("th",{class:"text-h6"},"\u5716\u7247"),o("th",{class:"text-h6"},"\u540D\u7A31"),o("th",{class:"text-h6"},"\u5206\u985E"),o("th",{class:"text-h6"},"\u4E0A\u67B6"),o("th",{class:"text-h6"},"\u7BA1\u7406")])],-1)),X={key:1},Y=y(()=>o("td",{class:"text-center",colspan:"5"},"\u6C92\u6709\u5546\u54C1",-1)),Z=[Y],ee={class:"text-center mt-5"},te=v("\u53D6\u6D88"),le=v("\u78BA\u5B9A"),ae={__name:"ProductsView",setup(u){const n=m([]),C=m(["\u8292\u679C","\u9999\u8549","\u706B\u9F8D\u679C"]),e=m({_id:"",name:"",price:"",category:"",description:"",image:[],sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),d=m({required(s){return!!s||"\u5FC5\u586B"},price(s){return s>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(s){var t,a,c;return!s||!s.length||((a=(t=s[0])==null?void 0:t.type)==null?void 0:a.includes("image"))&&((c=s[0])==null?void 0:c.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),x=(s,t)=>{console.log(e.image),e._id=s,t>-1?(e.name=n[t].name,e.price=n[t].price,e.category=n[t].category,e.sell=n[t].sell,e.description=n[t].description):(e.name="",e.price=0,e.category="",e.sell=!1,e.description=""),e.image=[],e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},S=async()=>{if(!e.valid)return;e.submitting=!0;const s=new FormData;for(const t in e)["_id","idx","valid","submitting","dialog"].includes(t)||(t==="image"?s.append(t,e[t][0]):s.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await b.post("/products",s);n.push(t.result),V.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await b.patch("/products/"+e._id,s);n[e.idx]=t.result,console.log(e),console.log(e.idx),V.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(t){V.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1};return(async()=>{try{const{data:s}=await b.get("/products/all");n.push(...s.result),console.log(n)}catch(s){V.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})(),(s,t)=>(p(),f(w,null,[o("div",J,[K,l(g,{class:"mt-5",color:"success",onClick:t[0]||(t[0]=a=>x("",-1))},{default:i(()=>[Q]),_:1}),l(h,{class:"mt-10"},{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(M,null,{default:i(()=>[W,o("tbody",null,[n.length>0?(p(!0),f(w,{key:0},I(n,(a,c)=>(p(),f("tr",{key:a._id},[o("td",null,[l(T,{src:a.image,cover:"",height:"200"},null,8,["src"])]),o("td",null,_(a.name),1),o("td",null,_(a.category),1),o("td",null,_(a.sell===!0?"\u4E0A\u67B6\u4E2D":"\u5DF2\u4E0B\u67B6"),1),o("td",null,[l(g,{icon:"",variant:"text",onClick:ie=>x(a._id,c)},{default:i(()=>[l(B,{icon:"mdi-pen"})]),_:2},1032,["onClick"])])]))),128)):(p(),f("tr",X,Z))])]),_:1})]),_:1})]),_:1})]),l(F,{modelValue:e.dialog,"onUpdate:modelValue":t[9]||(t[9]=a=>e.dialog=a),persistent:""},{default:i(()=>[l(D,{onSubmit:q(S,["prevent"]),modelValue:e.valid,"onUpdate:modelValue":t[8]||(t[8]=a=>e.valid=a)},{default:i(()=>[l(z,null,{default:i(()=>[l(A,null,{default:i(()=>[o("h2",ee,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l(E,null,{default:i(()=>[l(N,null,{default:i(()=>[l(h,null,{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(k,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.name=a),label:"\u5546\u54C1\u540D\u7A31",rules:[d.required],variant:"outlined","append-inner-icon":"mdi-star-outline"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:i(()=>[l(k,{type:"number",min:"0",modelValue:e.price,"onUpdate:modelValue":t[2]||(t[2]=a=>e.price=a),label:"\u5546\u54C1\u50F9\u683C",rules:[d.required,d.price],variant:"outlined","append-inner-icon":"mdi-bitcoin"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:i(()=>[l(P,{items:C,type:"number",min:"0",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=a=>e.category=a),label:"\u5546\u54C1\u5206\u985E",rules:[d.required],variant:"outlined","append-inner-icon":"mdi-lipstick"},null,8,["items","modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:i(()=>[l(O,{modelValue:e.sell,"onUpdate:modelValue":t[4]||(t[4]=a=>e.sell=a),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),_:1}),l(r,{cols:"12"},{default:i(()=>[l(R,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=a=>e.image=a),"show-size":"",accept:"image/*",label:"\u5546\u54C1\u5716\u7247",rules:[d.size],variant:"outlined","prepend-icon":"","append-inner-icon":"mdi-link-variant"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:i(()=>[l(j,{modelValue:e.description,"onUpdate:modelValue":t[6]||(t[6]=a=>e.description=a),label:"\u5546\u54C1\u63CF\u8FF0",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l($,null,{default:i(()=>[l(G),l(g,{color:"warning",onClick:t[7]||(t[7]=a=>e.dialog=!1),disabled:e.submitting,variant:"outlined"},{default:i(()=>[te]),_:1},8,["disabled"]),l(g,{type:"submit",color:"primary",loading:e.submitting,variant:"outlined"},{default:i(()=>[le]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1},8,["modelValue"])],64))}};var ce=U(ae,[["__scopeId","data-v-d57617f4"]]);export{ce as default};
